#!/bin/sh

# Script to install required external packages

# Set location of ruby to use
#RUBY=/whome/harrop/opt/ruby/bin/ruby
RUBY=/whome/harrop/opt/ruby-1.8.7-p352/bin/ruby
#RUBY=ruby

# Set location of WFM
WFM_DIR=`pwd`

# Install libxml-ruby
echo "==========================================="
echo "= INSTALLING libxml-ruby                  ="
echo "==========================================="
cd ${WFM_DIR}
tar -xzvf libxml-ruby-2.0.9.tar.gz
cd ${WFM_DIR}/libxml-ruby/ext/libxml
${RUBY} extconf.rb
make clean
make

# Install SystemTimer
echo "==========================================="
echo "= INSTALLING SystemTimer                  ="
echo "==========================================="
cd ${WFM_DIR}
tar -xzvf SystemTimer-1.2.3.tar.gz
ln -fs SystemTimer-1.2.3 SystemTimer
cd ${WFM_DIR}/SystemTimer/ext/system_timer
${RUBY} extconf.rb
make clean
make

# Install sqlite3
echo "==========================================="
echo "= INSTALLING sqlite3                      ="
echo "==========================================="
cd ${WFM_DIR}
tar -xzvf sqlite-autoconf-3070701.tar.gz
ln -fs sqlite-autoconf-3070701 sqlite3
cd ${WFM_DIR}/sqlite3
export CFLAGS="-Os -DSQLITE_ENABLE_COLUMN_METADATA"
./configure --prefix=`pwd`
make clean
make
make install
unset CFLAGS

# Install sqlite3-ruby
echo "==========================================="
echo "= INSTALLING sqlite3-ruby                 ="
echo "==========================================="
cd ${WFM_DIR}
tar -xzvf sqlite3-ruby-1.3.1.tar.gz
ln -fs sqlite3-ruby-1.3.1 sqlite3-ruby
cd ${WFM_DIR}/sqlite3-ruby/ext/sqlite3
export LD_RUN_PATH=${WFM_DIR}/sqlite3/lib
${RUBY} extconf.rb -- --with-sqlite3-dir=${WFM_DIR}/sqlite3
make clean
make
unset LDFLAGS

